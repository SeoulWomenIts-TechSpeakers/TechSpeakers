### ğŸ¥‘ Could not resolve placeholder 'spring.redis.host' in value "${spring.redis.host}"

- application.properties ì— ë³€ìˆ˜ì„¤ì • ì½ëŠ”ë° ë¬¸ì œê°€ ìˆëŠ” ë“¯
- redis ì„¤ì • host/postì˜ ìˆœì„œë¥¼ ë³€ê²½í•´ì•¼í•¨

```
    @Value("${spring.redis.host:localhost}")
    private String host;

    @Value("${spring.redis.port:6379}")
    private String port;
```

- ì´ëŸ°ì‹ìœ¼ë¡œ ë””í´íŠ¸ ê°’ì„ ì„¤ì •í•´ì£¼ì–´ì„œ í•´ê²°ì€ í–ˆìœ¼ë‚˜, ë¬´ì—‡ì´ ì›ì¸ì¸ì§€ëŠ” ëª¨ë¥´ê³˜ìŒ

### ğŸ¥‘ java.lang.IllegalMonitorStateException: attempt to unlock lock, not locked by current thread by node id: b5d23d89-809d-4e26-b060-03dfb6e03459 thread-id: 90

- í…ŒìŠ¤íŠ¸ ê³¼ì •ì—ì„œ ìŠ¤ë ˆë“œ í• ë‹¹ì—ì„œ ì˜¤ë¥˜ê°€ ë‚¨
- https://kirinman.tistory.com/97

### ğŸ¥‘ í…ŒìŠ¤íŠ¸ Redisson Lock íšë“ ì‹¤íŒ¨ : null

- redis ì„œë²„ì—ì„œ keyë¡œ ê°’ì„ ì°¾ì„ ë•Œ ê°’ì´ ì—†ì–´ì„œ ì—¬ê¸°ì„œë¶€í„° ì—ëŸ¬ê°€ ë‚¨
- https://velog.io/@greentea/spring-RedisTemplate.hasKey%EA%B0%92%EC%9D%B4-null%EC%9D%B4-%EB%82%98%EC%98%AC-%EA%B2%BD%EC%9A%B0 `keyê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.`
- haskeyë¡œ ë³€ê²½í•¨

### ğŸ¥‘ ìŠ¤ë ˆë“œê°€ ë™ì‹œì„± ë°˜ì˜ ëª»í•˜ê³  ìˆìŒ

![alt text](image.png)

- ì„ê³„ì˜ì—­ì— ëŒ€í•´ ë½ ì œëŒ€ë¡œ íšë“ì´ ì•ˆë˜ê³  ìˆëŠ”ê²ƒ ê°™ìŒ
- boolean isLocked = lock.tryLock(3, 3, TimeUnit.SECONDS);

### ğŸ¥‘ í˜¸ìŠ¤íŠ¸ ë©”ì¸ í…Œì´ë¸”ì˜ DB ì¬ê³  ì—…ë°ì´íŠ¸ê°€ ë°”ë¡œ ë°”ë¡œ ì•ˆë¨

```
// 4) redis ì¬ê³  ì°¨ê° write through
redisService.deductAvailPpl(hnum, curReqPpl);
// í˜¸ìŠ¤íŠ¸ ì¬ê³  ì°¨ê°
host.get().updateIvtPpl(histRequestDto.getReqPpl());
hostRepository.save(host.get());
```

- redis ì—…ë°ì´íŠ¸ í•˜ê³  ë°”ë¡œ db ì—…ë°ì´íŠ¸ì¸ë° ì™œ ì—…ë°ì´íŠ¸ ë°”ë¡œ ì•ˆë¨?
  ![alt text](image-1.png)
- redisëŠ” ì œëŒ€ë¡œ ì—…ë°ì´íŠ¸ ë˜ê³  ìˆëŠ”ë° ì•ˆë˜ê³  ìˆìŒ
- Entity update ë©”ì„œë“œì— ì¬ê³  ê°’ì„ ì²˜ìŒ host entity ìƒì„±ë  ë–„ì˜ ê·¸ ê°’ìœ¼ë¡œ ì£¼ê³  ìˆì—ˆê¸° ë•Œë¬¸ì—, ìµœì´ˆ ê°’ì—ì„œ ë§¤ë²ˆ -ì°¨ê°

```
public void updateIvtPpl(int curIvtPplByHost, int reqPpl) {
    this.ivtPpl = curIvtPplByHost - reqPpl;
}
```

- í˜„ì¬ ì¡°íšŒëœ ì°¨ê°ëœ ì¬ê³ ì˜ ê°’ê³¼ í•¨ê»˜ ì°¨ê°í•  ê°’ë„ ë„˜ê²¨ì¤Œ
